
general outline of Dimon main()
   init_options()
      - init main structs: gD, GS, GAC, g_dicom_ctrl, A
      - populate p->opts struct from options
      - perform a few checks and var inits
   init_extras()
      - set 'nice' level and possibly init afni communication
   find_first_volume()
      - scan scan p->fim_o for a complete volume
      - while not done
         - read_image_files()    : read actual Dicom files (in state TO_READ)
            - get_sorted_file_names()
               - apply alphabetical or other file name sorting
            - read_new_images()
               - populate p->fim_o list with newly read images
                  - read those in state IFM_FSTATE_TO_READ
                  - set state to TO_PROC
            - make_sorted_fim_list()
               - sort p->fim_o in the new range (from fim_start to nfim)
                  - apply main sort, such as DEFAULT, GEME, NUM_SUFF
                  - possibly post-order as zt
                  - update fim_start to point to next TO_PROC image
         - n2proc = nfim2proc() = num images in TO_PROC state
         - volume_search()
         - if no vol: think about life and paramaters, nap, try again
         - have vol, so...
            - update params (now that we know what to look for)
            - send vol to afni -rt
            - set sent image states to FSTATE_DONE
   find_more_volumes()
      - set to handle many signals by hf_signal()
      - set_volume_stats()
      - while not done
         - while there are read volumes that match v0
            - set_volume_stats()
            - send vol to afni -rt
            - update sent image states to FSTATE_DONE
         - read_image_files() : read any files in state TO_READ
         - n2proc = nfim2proc() = num images in TO_PROC state
         - if no volume of images to proc
            - quit, whine or read_image_files()



states:
   IFM_FSTATE_TO_READ      - ready to read image
                           - set at start of read_image_files()
   IFM_FSTATE_TO_PROC      - ready to start processing (from filename)
   IFM_FSTATE_TO_SORT      - ready to sort (window sorting)
                           - currently specific to GEME sorting
                           - it is within range of images to sort
   IFM_FSTATE_DONE         - finished sending volume


Sorting images make_sorted_fim_list():
   - search from offset fim_start
   - based on sort_method, sort_acq_time, sort_num_suff, dicom_org

   - sort:
      IFM_SORT_ACQ_TIME (same as DEFAULT, but with gsba set)
         g_sort_by_atime = 1;
         compare_finfo_t()

      IFM_SORT_GEME
         sort_by_geme_index()
            - compute n2sort (nfim - fim_start)
            - geme_set_range_n_state()
               - set state to TO_SORT for any in local window
               - note how many images are in sorting window
            - geme_set_sort_indices()
               - ...

      IFM_SORT_DEFAULT
         compare_finfo_t()
            - sort by state (if diff)
            - state is not TO_PROC, sort by findex
            - return compare_finfo()
               - sort by run (if diff)
               - if( g_sort_by_atime ) sort by atime
               - sort by IMAGE INDEX (0054 1330) (if diff)
               - sort by REL Inst Num (0020 0013) (if diff)
               - return 0 (equal)

      IFM_SORT_NUM_SUFF
         compare_finfo_num_suff()
            - sort by state (if diff, return compare_by_num_suff)
            - same state:
               - if state != TO_PROC, sort by findex
               - else, return compre_by_num_suff()
               compare_by_num_suff()
                  - if diff, sort
                  - else sort alphabetically

      IFM_SORT_ZPOSN
         compare_finfo_z()
            - sort by state
            - if equal && not TO_PROC: sort by findex
            - sort by volume index (findex/g_num_slices)
            - sort by zoff
            - sort by findex
